# Cancel Suscription

The POST /subscription.cancel/{subscriptionId} endpoint allows merchants to cancel an existing One Click Payment (OCP) subscription, revoking the customer's prior authorization for future charges.

This functionality ensures that merchants can manage the lifecycle of a subscription, allowing them to deactivate subscriptions when no longer needed or upon customer request. Once canceled, the subscription token becomes invalid and can no longer be used for initiating payments.

### Endpoints

> **üìò URL**
>
> **Certification:** <https://cert.subscriptions.payin.monnet.io/api/v1/subscription/cancel>
>
> **Production:** <https://subscriptions.payin.monnet.io/api/v1/subscription/cancel>

## üìù Subscription Cancellation Request

### üîê Header Required

All requests to the **/subscription.cancel** endpoint must include a custom **Authorization** header to ensure secure communication and proper merchant validation.

| Header | Value Format | Required |
| ------------- | ---------------------------------------------------------------------------- | -------- |
| Authorization | Bearer **SHA512**(merchantId + type + customerId + processorCode + keyPayin) | ‚úÖ Yes |

The **Authorization** value must be a **SHA-512 hash** generated by concatenating the following fields:

| Field | Description |
| :--- | :--- |
| merchantId | **Integer (Required)** <br> Unique identifier assigned to the merchant by Monnet. |
| type | **String (Required) <br> **Type of operation. Possible values: `ON_DEMAND` (one-time payment) or `RECURRENT` (recurring payment). |
| customerId | **String (Required) <br> **Unique identifier of the end user or customer within the merchant‚Äôs system. |
| processorCode | **String (Required)** <br> Code identifying the payment processor to be used for the transaction. |
| keyPayin | **String (Required)** <br> Secret key provided by Monnet for secure authentication of payment operations. |

### üì• Request Data

Specifies the structure and required parameters for the request body to ensure the successful cancellation of a subscription.

| Field | Description |
| :--- | :--- |
| merchantId | **Integer (Required)** <br> Unique ID assigned to the merchant by Monnet |
| subscriptionDetails | **Object (Required)** |
| type | **String (Required)** <br> Subscription type. Allowed value: `ON_DEMAND` or `RECURRENT` |
| customerId | **String (Required)** <br> Unique identifier of the customer within the merchant‚Äôs system <br> **Example:** <br> 992984321 |
| processorCode | **String (Required)** <br> Code identifying the selected payment processor <br> Example: <br> `Yape_on_file` |

This service allows merchants to cancel an existing One Click Payment (OCP) subscription associated with a customer. Once canceled, the subscription token will no longer be valid for initiating future payments.

### Request Body (JSON)

The merchant must send a JSON payload with the following structure:

```json
{
  "merchantId": 1073741824,
  "subscriptionDetails": {
    "type": "ON_DEMAND",
    "customerId": "140912518",
    "processorCode": "Yape_on_file"
  }
}
```

## üîÑ Subscription Cancellation Response

### üì§ Success Response Data

| Field | Description |
| :--- | :--- |
| subscriptionId | **Integer (Required)** <br> Unique identifier of the subscription that has been successfully cancelled |
| status | **String (Required)** <br> Status returned by processor. <br> **Example** <br> **CANCELLED** |

If the subscription cancellation request is valid, the service will respond with a 200 OK status and return a JSON payload confirming the operation, including the subscription ID and a status indicating that the subscription has been successfully cancelled.

### ‚úÖ Successful Response ‚Äì 200 OK

```json
{
  "subscriptionId": 1073741824,
  "status": "CANCELLED"
}
```

### üì§ Error Response Data

| Field | Description |
| :--- | :--- |
| errorCode | **String (Opcional)** <br> General code representing the main error type. Typically business-level. <br> See Errors Code |
| errorMessage | **String (Required)** <br> Human-readable description of the general error <br> See Errors Code |
| errorFieldDetails | **Array (Opcional)** <br> List of specific errors encountered during processing |
| fleld | **String (Required)** <br> Refers to the affected field. |
| errorMessage | **String (Required)** <br> Description of the specific error |

This response indicates that the subscription transaction could not be processed due to a business or validation error. It provides both a general error message and a detailed list of one or more specific underlying errors.

### ‚ùå Error Response Body (JSON)

```json
{
    "errorCode": "9025",
    "errorMessage": "Unable to locate record on file"
}
```

## Error Codes

| Error Code | Error Message |
| :--------- | :----------------------------------------------------------- |
| E401 | Unauthorized request |
| B401 | The merchant does not exists |
| B404 | The merchant does not contain the correct processor settings |
| B405 | Subscription not active |
| B409 | Conflict request |
| 9025 | Unable to locate record on file |
| 9099 | error |
